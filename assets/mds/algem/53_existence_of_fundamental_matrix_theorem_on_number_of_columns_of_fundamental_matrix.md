## Существование и количество столбцов
Как было сказано, для существования фундаментальной матрицы нужны нетривиальные решения однородной системы.

Если ранг матрицы однородной системы $r$ меньше числа неизвестных переменных $n$, то система имеет фундаментальную матрицу из $n-r$ столбцов (чем меньше ранг системы, тем больше фундаментальная система).
Самый примитивный случай - ранг максимальный ($r = n$), тогда матрица невырожденная, отчего система имеет лишь одно решение. Мы знаем, что приведенная система всегда имеет тривиальное решение, поэтому оно будет единственное. Однако если тривиальное решение - единственное, как уже было написано, фундаментальной матрицы не существует.

Найдем решения для приведенной системы, с помощью метода Гаусса, описанного ранее. Так как у приведенной системы $b = 0$, то коэффициенты $b_i$ отпадают. Фиксируем свободные переменные "константами" $c$ и получаем систему:
$$\cases{
x_1 = - (a'_{11}x_{r+1} + a'_{12}x_{r+2} + \ldots + a'_{1(n-r)}x_{n}) \\
x_2 = - (a'_{21}x_{r+1} + a'_{22}x_{r+2} + \ldots + a'_{2(n-r)}x_{n}) \\
\ldots \\
x_r = - (a'_{r1}x_{r+1} + a'_{r2}x_{r+2} + \ldots + a'_{r(n-r)}x_{n}) \\ 
x_{r+1} = c_1 \\ 
x_{r+2} = c_2 \\ 
\ldots \\
x_n = c_{n-r}
}$$
Эта система совпадает с уравнением $x = Fc$ ,где
$$c = \pmatrix{c_1 \\ c_2 \\ \vdots \\ c_{n-r}}$$
Записываем коэффициенты системы в матрицу $F$. Раньше у нас была "длинная" матрица, но теперь у нее будет дополнение по вертикали (единичной матрицей):
$$F = \pmatrix{-A' \\ E} = \pmatrix{-a'_{11} & -a'_{12} & \ldots & -a'_{1(n-r)} \\ -a'_{21} & -a'_{22} & \ldots & -a'_{2(n-r)} \\ \vdots & \vdots & \ddots & \vdots \\ -a'_{r1} & -a'_{r2} & \ldots & -a'_{r(n-r)} \\ 1 & 0 & \ldots & 0 \\ 0 & 1 & \ldots & 0 \\ \vdots & \vdots & \ddots & \vdots \\ 0 & 0 & \ldots & 1}$$
1. Для любого $c$, произведение $x = Fc$ будет являться решением уравнения $Ax = 0$, поэтому условие (3) выполнено для матрицы $F$. (вектор $c$ разложил решение по столбикам $F$)
2. Ранг матрицы $F$ равен количеству столбиков, ведь нижняя часть этой матрицы - единичная матрица. У единичной матрицы ранг максимален (равен $n-r$), а ранга больше у матрицы шириной $n-r$ попросту быть не может. Раз ранг максимален, то все **столбики** линейно независимы, и условие (2) выполнено.
3. Наконец, условие (1). Произведение $AF = 0$ можно рассмотреть как сумму произведений матриц $A$ на каждый столбик $F$ (вспомните билет с умножением матриц)
   $$A\pmatrix{-a'_{11} \\ -a'_{21} \\ \vdots \\ -a'_{r1}\\ 1 \\ 0 \\ \vdots \\ 0} + A\pmatrix{-a'_{12} \\ -a'_{22} \\ \vdots \\ -a'_{r2}\\ 0 \\ 1 \\ \vdots \\ 0} + \ldots + A\pmatrix{-a'_{1(n-r)} \\ -a'_{2(n-r)} \\ \vdots \\ -a'_{r(n-r)}\\ 0 \\ 0 \\ \vdots \\ 1} = 0$$
   Но каждое такое произведение равно нулю, потому что взяв $c$ равным $j$-тому столбику единичной матрицы, после произведения $Fc$ мы получим $j$-тый столбик матрицы $F$. А раз для любого столбика $c$, $x = Fc \Rightarrow Ax = 0$, то все произведения выше равны нулю (мы ищем произведение $A$ на каждый столбик $F$). Условие (1) выполнено!

Все три условия выполнились, а значит $F$ является фундаментальной матрицей.
Напомню, что все, что мы сделали, чтобы найти матрицу $F$ - привели $A$ к упрощенному виду и нашли матрицу, соответствующую новой системе уравнений.
Как мы показали этим алгоритмом, из любой матрицы с нетривиальными решениями можно получить фундаментальную матрицу. Причем у этой матрицы получилось $n-r$ столбиков, что и доказывает теорему.
## Составление собственной ФСР
***Любая*** система из $n-r$ линейно независимых решений является ФСР! Матрица $P$, составленная из таких решений, сразу будет удовлетворять условиям (1) и (2). Чтобы показать условие (3), рассмотрим матрицу, состоящую из склееных фундаментальной матрицы $F$, матрицы решений $P$ и какого-то решения системы $x$:
$$V = (F|P|x)$$
Так как все столбики $P$ и $x$ - линейные комбинации столбиков $F$ (ведь те столбики - решения системы), а $\rg F = n-r$ (ведь столбики линейно независимы), то и $\rg V = n-r$. Но и в матрице $P$ все столбики линейно независимые, поэтому и $\rg P = n-r$. Получается, $P$ - тоже базисная подматрица, и как следствие, $x$ раскладывается по столбцам $P$ - условие (3) выполнено.

Все три условия выполнены, а значит $P$ - фундаментальная матрица.
## Общее решение неоднородной системы
Фундаментальные матрицы помогают нам решать неоднородные системы. Если для любого столбика $c$, $y = Fc$ - решение приведенной системы $Ay = 0$, а $x = x_0 + y$ описывает множество решений для неоднородной системы $Ax = b$, ($x_0$ - какое-то решение неоднородной системы) получается, что
$$x = x_0 + Fc$$
Выражение справа ($x_0 + Fc$) называется *общим решением неоднородной системы линейных уравнений*, или же:
$$x = x_0 + c_1f_1 + c_2f_2 + \ldots c_{n-r}f_{n-r}$$
В начале билета мы говорили, чтобы у системы было только одно решение, матрица системы $A$ должна быть невырождена ($\det A \neq 0$). Теперь мы можем показать, что если $\det A = 0$, то $\rg A < n$ ($n$ - количество строк в матрице $A$), а значит, приведенная система имеет бесконечное количество решений. Из этого следует, если у оригинальной системы есть хоть одно решение, то благодаря фундаментальной матрице можно увидеть бесконечное количество решений. Если же решений у оригинальной системы нет, то их не будет вовсе.
## Пример задачи
Условие: найти общее решение системы линейных уравнений $Ax = b$, где
$$A = \pmatrix{1 & -4 & 2 & 0 & 3 \\ 2 & -7 & 4 & 1 & 0 \\ 1 & -3 & 2 & 1 & -3}, \ \ \ \ \ \ b = \pmatrix{5 \\ 9 \\ 4}$$

Решение: совместность этой системы мы уже доказали в прошлом билете, и узнали, что "ее ранг" равен двум.
Для отработки пройденого материала, найдем сначала общее решение приведенной системы:
$$\pmatrix{1 & -4 & 2 & 0 & 3 \\ 2 & -7 & 4 & 1 & 0 \\ 1 & -3 & 2 & 1 & -3} x = \pmatrix{0 \\ 0 \\ 0}$$
Я просто скопирую к чему мы пришли с помощью метода Гаусса из прошлого билета:
$$\sim \pmatrix{1 & -4 & 2 & 0 & 3 \\ 0 & 1 & 0 & 1 & -6}$$
Сложим с первой строкой вторую, умноженную на четыре, чтобы явно отделить базисные переменные:
$$\sim \pmatrix{1 & 0 & 2 & 4 & -21 \\ 0 & 1 & 0 & 1 & -6}$$
Переменные $(1)$ и $(2)$ (там, где только единицы в одной строке, а во всех остальных - нули) будут базисными, остальные ($(3), (4), (5)$) - свободными.
$$\cases{x_1 + 2x_3 + 4x_4 - 21x_5 = 0 \\ x_2 + x_4 - 6x_5 = 0} \Rightarrow \cases{x_1 = -2x_3 - 4x_4 + 21x_5 \\ x_2 = -x_4 + 6x_5}$$
Общее решение записывается как вектор - базисные векторы выражаются через свободные, а свободные просто записываются на свои места без каких-либо модификаций. Общее решение приведенной системы:
$$(\array{-2x_3 - 4x_4+21x_5; &-x_4+6x_5;&x_3;&x_4;&x_5})$$
Бонус: построение фундаментальной матрицы через общее решение получается просто с помощью подстановки в каждую свободную переменную единицу, а в остальные нули:
$$\array{
x_3: (\array{-2;& 0;& 1;& 0;& 0}) \\
x_4: (\array{-4;& -1;& 0;& 1;& 0}) \\
x_5: (\array{21;& 6;& 0;& 0;& 1})
}$$
Тогда фундаментальная матрица выглядит так (ведь все это решения, и они линейно независимы, ведь внизу находится единичная матрица, поэтому ранг максимален и все такое)
$$F = \pmatrix{-2 & -4 & 21 \\ 0 & -1 & 6 \\ 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1}$$
Общее решение ***равносильно*** можно записать как линейную комбинацию столбиков этой матрицы:
$$X = c_1\pmatrix{-2 \\ 0 \\ 1 \\ 0 \\ 0} + c_2 \pmatrix{-4 \\ -1 \\ 0 \\ 1 \\ 0} + c_3 \pmatrix{21 \\ 6 \\ 0 \\ 0 \\ 1}$$
Ну да вернемся к решению. Мы нашли общее решение приведенной системы, но нам же нужно найти решение оригинальной системы!
В этом и плюс нашего общего решения: чтобы найти все решения оригинальной системы, мы можем найти лишь одно решение оригинальной системы, и прибавить к нему общее решение приведенной.

Быстренько методом Гаусса приведем расширенную матрицу системы к упрощенному виду:
$$(A|b) \sim \pmatrix{
1 & 0 & 2 & 4 & -21 & | & 1 \\
0 & 1 & 0 & 1 & -6 & | & -1}$$
Система выглядит таким образом:
$$\cases{x_1 = 1 - 2x_3 - 4x_4 + 21x_5 \\ x_2 = -1 - x_4 + 6x_5}$$
В общем виде:
$$(\array{1-2x_3-4x_4+21x_5;& -1-x_4+6x_5;&x_3;&x_4;&x_5})$$
Нам нужно любое решение этой системы, поэтому возьмем самое простое - примитивное. Подставляем нули за все иксики:
$$(1;-1;0;0;0)$$
Теперь общее решение оригинальной системы будет равно сумме частного решения оригинальной и общего решения приведенной:
$$\pmatrix{-2x_3 - 4x_4+21x_5 \\ -x_4+6x_5 \\ x_3 \\ x_4 \\ x_5} + \pmatrix{1 \\ -1 \\ 0 \\ 0 \\ 0} = \pmatrix{-2x_3 - 4x_4+21x_5+1 \\ -x_4+6x_5-1 \\ x_3 \\ x_4 \\ x_5}$$
Это и будет *общим решением системы уравнений*.

Ради проверки, возьмем какие-нибудь значения для свободных переменных - единички. Тогда одно из решений будет выглядеть следующим образом:
$$\pmatrix{-2-4+21+1 \\ -1+6-1 \\ 1 \\ 1 \\ 1} = \pmatrix{16 \\ 4 \\ 1 \\ 1 \\ 1}$$
Подставляем их в систему:

$$A = \pmatrix{1 & -4 & 2 & 0 & 3 \\ 2 & -7 & 4 & 1 & 0 \\ 1 & -3 & 2 & 1 & -3}, \ \ \ \ \ \ b = \pmatrix{5 \\ 9 \\ 4}$$
$$\cases{1\cdot 16 - 4 \cdot 4 + 2 + 0 + 3 = 5 \\ 2\cdot 16 -7 \cdot 4 +4 + 1 = 9 \\ 1 \cdot 16 - 3 \cdot 4 + 2 + 1 -3 = 4} \Rightarrow \cases{5=5 \\ 9=9 \\ 4=4}$$
Проверка успешна :)