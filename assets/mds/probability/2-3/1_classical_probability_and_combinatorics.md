- [Простые схемы](#простые-схемы)
	- [Схема $n^r$](#схема-mask)
	- [Схема размещений](#схема-размещений)
	- [Схема сочетаний](#схема-сочетаний)
- [Усложненные схемы](#усложненные-схемы)
	- [Схема перестановок с повторениями](#схема-перестановок-с-повторениями)
	- [Схема сочетаний с повторениями](#схема-сочетаний-с-повторениями)
- [Подсчет](#подсчет)

Вероятность события $X$, в ее классическом понимании, определяется как отношение количества благоприятных исходов $M$ к количеству всевозможных исходов $N$, и обычно записывается как
$$P(X) = \frac MN$$
Чтобы считать эти количества исходов, в корне теории вероятности лежит комбинаторика - важно хорошо овладеть комбинаторными формулами. Часто в задачах фигурируют шары и урны, и непросто так - на них удобно показывать все схемы.
## Простые схемы
### Схема $n^r$
Представим комбинационный замок - на нем $r$ колес, а на каждом колесе $n$ символов. Сколько всего можно собрать комбинаций на этом замке? Как раз $n^r$ - на каждом колесе по $n$ возможных выборов, а всего колес $r$:
$$N = n \cdot n \cdot \ldots \cdot n = n^r$$
Эта схема обобщается на случай, когда в $i$-том колесе содержится $n_i$ символов - тогда по аналогичной логике всего будет комбинаций:
$$N = n_1 \cdot n_2 \cdot \ldots \cdot n_r = \prod_{i=1}^r n_i$$
Схема так же распознается по словам ***"с возвращением"***: допустим в одной урне лежит $n$ уникально нумерованных шаров. Мы случанйым образом достаем шар из урны, записываем ее номер, кладем шар обратно, и делаем так всего $r$ раз. Количество возможных номеров так же равно $n^r$.

Можно представлять набор шаров как ***активную процедуру***: первый шар мы можем выбрать $n$ разными способами - ведь в урне всего $n$ шаров. Достали, записали номер, положили обратно. Второй шар мы можем снова выбрать $n$ разными способами - количество шаров в урне не изменилось. Способы для каждой выборки мы перемножаем, и спустя $r$ таких взятий мы получаем $n^r$. Надеюсь, принцип ясен.

### Схема размещений
Пусть перед нами урна, в которой $n$ уникально нумерованных шаров. Будем вытаскивать $r$ шаров и класть их по порядку перед урной. Сколько способов получить разные последовательности шаров?

Снова опишем процедуру: первый шар из урны мы можем достать $n$ разными способами. Кладем его перед урной. Второй же шар можно достать уже только $(n-1)$ способом (в урне стало на один шар меньше). Снова достаем и кладем перед урной после первого шара. Положив $r$ шаров таким образом получим произведение:
$$N = n(n-1)(n-2)\ldots(n-r+1) = \frac{n!}{(n-r)!} = A^r_n$$
Количество способов разложить $r$ элементов из $n$ *с учетом порядка* называется количеством размещений, и обозначается как $A^r_n$.

Размещения сводятся до *перестановок*, когда $r=n$. Тогда $A^r_n = A^n_n = n!$.

### Схема сочетаний
Возьмем прошлые условия, но вместо того, чтобы складывать шары по порядку, будем складывать их в другую урну - благодаря этому порядок размещения шаров теряется. Сколько способов получить разные урны (урны с разными номерами шаров)?

Идея с сочетаниями такая же, как и с размещениями - но на каждое размещение $r$ шаров найдется $r!$ перестановок с этими же шарами, но в другом порядке. Так как нас не волнует порядок в сочетаниях, мы сокращаем каждое размещение на количество их перестановок:
$$N = \frac{A^r_n}{r!} = \frac{n!}{r!(n-r)!}= C^r_n $$
Количество способов разложить $r$ элементов из $n$ *без учета порядка* называется количеством сочетаний, и обозначается как $C^r_n$.

Полезное свойство: $C^r_n = C^{n-r}_n$.

---
Различать размещения и сочетания мне помогает, если я думаю о наборах в процедуре, как о массивах (array) и множествах (set): беру я ли какую-то последовательность элементов, или просто закидываю их в мешок? В зависимости от ответа я и выбираю размещения или сочетания.

## Усложненные схемы
### Схема перестановок с повторениями
Общая постановка: перед нами $n$ нумерованных шаров, *но шаров с номером $i$ есть $k_i$ штук* (всего $r$ различных шаров). Сколько существует способов перестановок этих шаров?

Вспомним обычные шары, когда все они были уникально нумерованными - тогда количество перестановок просто равнялось $n!$. Так, например, для трех шаров были перестановки $\set{123, 132, 213, 231, 312, 321}$. Если мы заменим шар с номером $1$ на шар с номером $2$, у нас начнут повторяться перестановки: $\set{223, 232, 223, 232, 322, 322} = \set{223, 232, 322}$.

Здесь логика та же, что и со схемой сочетаний - для каждой перестановки с шарами с номером $2$ существует другая перестановка, где их поменяли местами. Из-за этого количество действительно различных перестановок падает вдвое. Более обще, для выборки, где повторяются $k$ шаров, количество различных перестановок будет сокращено в $k!$ раз (по причинам описанным в схеме сочетаний).

Применяя такую логику для каждых повторяющихся шаров, получаем число перестановок с повторениями:
$$N = \frac{n!}{\prod\limits_{i=1}^r (k_i!)} = \frac{n!}{k_1! k_2! \ldots k_r!}$$

Можно взглянуть на задачу под другим углом: пусть даны $n$ уникально нумерованных шаров, и нужно разложить их на $r$ урн с численностями $k_1, \ldots, k_r$. Тогда процедура звучит так: выбираем $k_1$ шар из $n$ предложенных нам, которые мы сбросим в первую урну. Количество способов выбрать их будет $C^{k_1}_n$. Теперь выбираем $n_2$ шаров, но уже из $(n - k_1)$ оставшихся шаров. Количество способов выбора - $C^{k_2}_{n-k_1}$. Продолжая так до конца получим произведение сочетаний, которое на самом деле сокращается к формуле выше:
$$N = C^{k_1}_n \cdot C^{k_2}_{n - k_1} \cdot \ldots \cdot C^{k_r}_{n-\ldots - k_{r-1}}= \frac{n!}{k_1! k_2! \ldots k_r!}$$

### Схема сочетаний с повторениями
Обычно эта схема всегда соответствует размещению шаров в урны. Пусть дано $n$ уникально нумерованных урн и $r$ неразличимых шаров. Сколькими способами можно разложить все шары в урны?

Количество способов разложения будет равно количеству решений уравнения
$$k_1 + k_2 + \ldots + k_n = r$$
при $k_i \geq 0$. Для понимания формулы, используемой в этой схеме, используют метод шаров и перегородок: возьмем $r$ шаров и $n-1$ перегородку. Перемещая их между собой, мы однозначно получаем способ распределения шаров внутри коробок. Так, например, для $5$ коробок и $5$ шаров:
$$\array{\circ \circ | \circ | \ | \circ |\circ \ &=& \set{1, 2}, \set 3, \set{}, \set 4, \set 5 \\ \circ \ | \ | \circ | \circ \circ \ | \circ\  &=& \set 1, \set 2, \set{3,4}, \set 5}$$
Как видим, подобное представление дает однозначное соответствие между распределением шаров в урны и переставлением шаров между перегородками.

Поэтому количество способов разложить $r$ шаров в $n$ урн считается как $C^r_{r+n-1}$. Заметим, что $C^r_{r+n-1} = C^{n-1}_{r+n-1}$, ведь неважно, перемещаем мы шары или перегородки.

Иногда на такую схему накладываются условия по типу "без пустых урн": тогда перед применением этой формулы мы вручную в каждую урну раскидываем по шару, и затем снова смотрим ту формулу. После раскидывания по шару в каждую урну, остается $r-n$ шаров ($n$ шаров мы уже разложили). Тогда количество способов разложить $r$ шаров в $n$ урн ***без пустых урн*** становится $C^{(r)-n}_{(r+n-1) - n} = C^{r-n}_{r-1}$. 
## Подсчет
Решение задачи сводится к прочтению условия задачи, выделения из нее кусков, в которых описываются *все исходы* и *благоприятные исходы*, и использования комбинаторных схем для нахождения их количества. Например:

> Из урны, содержащей $10N$ нумерованных шаров с номерами от $1$ до $10N$ вынимают $2N$ шаров. С какой вероятностью среди них будут $3$ шара с номерами, кратными $N$?

$P = \frac mn$.

Выделяем куски: первое предложение описывает все исходы, второе - благоприятные.

Для всех исходов: всего $10N$ шаров, мы выбираем $2N$ из них. О порядке мы по условию задачи тоже не заботимся, поэтому выбираем сочетания: $n = C^{2N}_{10N}$.

Для благоприятных: всего в выборке ($10N$ шаров) есть только $10$ шаров, которые кратны $N$. Разделим все шары как раз на такие группы: шары с номерами кратными $N$, и не кратными $N$ соответственно.
- Из первой группы нам нужно выбрать три шара: $C^3_{10}$.
- Из второй группы (размером в $10N - 10$) мы выбираем $(2N-3)$ шара: $C^{2N-3}_{10N-10}$.

Получаем $M = C^3_{10} \cdot C^{2N-3}_{10N-10}$.

Составляем ответ:
$$P = \frac{C^3_{10} \cdot C^{2N-3}_{10N-10}}{C^{2N}_{10N}}$$
